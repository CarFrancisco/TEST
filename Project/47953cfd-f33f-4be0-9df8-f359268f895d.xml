{"CLs":[{"__type":"LD","Var":"StartCycle"},{"__type":"FB","In":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":1,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"NewSwitch","Up":true},{"__type":"PRM","Arg":"PosStart","Ix":2,"Type":"REAL","Var":"100"},{"__type":"PRM","Arg":"PosAbs","Ix":3,"Type":"BOOL","Var":"false"},{"__type":"PRM","Arg":"Length","Ix":4,"Type":"REAL","Var":"40"}],"Ix":6,"Name":"TS_AddSwitch","Out":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":5,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"ENO"}],"UD":true,"X":1,"Var":"AddFirstPitch"}],"CMT":"At the start of a cycle, we put a first switch after 100 [u] and of a witdh of 40 [u].\u000d\u000a\u000d\u000aThe \"PosAbs\" let the FB computing the position depending of the current axis position.\u000d\u000a\u000d\u000aThis FB will convert the switch position (On: Act+100, Off: Act+100+40) in a timestamp [ns]. To make this converision, it will take the current axis speed.","LRI":7,"RRI":8,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"TS_Device_1.Enable"},{"__type":"LD","Ix":1,"Var":"UseCompensation","X":1},{"__type":"FB","In":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":2,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"Enable"}],"Ix":8,"Name":"TS_Compensation","Out":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":3,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"DeltaTS_On","Ix":4,"Type":"DINT","Var":""},{"__type":"PRM","Arg":"AvgTS_On","Ix":5,"Type":"DINT","Var":""},{"__type":"PRM","Arg":"DeltaTS_Off","Ix":6,"Type":"DINT","Var":""},{"__type":"PRM","Arg":"AvgTS_Off","Ix":7,"Type":"DINT","Var":""}],"UD":true,"X":2,"Var":"CompensePitch"}],"CMT":"Option: \u000d\u000aBut this conversion work fine if the speed is constant. If you have a lot of variation between cycle, the computed TS can be not perfect...\u000d\u000a\u000d\u000aTo improve the TS, you can use this FB. It will recompute every cycle the new TS, and make an average.","LRI":9,"RRI":10,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"TS_Device_1.Enable"},{"__type":"FB","EC":"(1)","In":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":4,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"Enabled"},{"__type":"PRM","Arg":"Output_Sta","Ix":5,"Type":"BOOL","Var":"Device1_Output_Status"},{"__type":"PRM","Arg":"Output_TS","IO":true,"Ix":6,"Type":"ULINT","Var":"Device1_Output_TS"}],"Ix":16,"Name":"TS_Output_Single","Out":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":7,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"Done"},{"__type":"PRM","Arg":"Output_Cmd","Ix":8,"Type":"BOOL","Var":"Device1_Output"},{"__type":"PRM","Arg":"Output_TS","IO":true,"Ix":9,"Type":"ULINT","Var":"Device1_Output_TS"},{"__type":"PRM","Arg":"SwitchDone","Ix":10,"Type":"THE\\TimeStamp_Switch","Var":"LastSwitch"}],"UD":true,"X":1,"Var":"ApplyOutput"},{"__type":"F","EC":"(2)","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":1,"Type":"ANY_NUM, STRING","Var":"LastSwitch.PosStart"},{"__type":"PRM","Arg":"In2","Ix":2,"Type":"ANY_NUM, STRING","Var":"REAL#200.0"}],"Ix":18,"Name":"@+","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"","Ix":3,"Type":"ANY_NUM, STRING","Var":"NextPos"}],"X":2,"Id":"1e13d389-f026-401c-940c-b11c0000002a","PL":true},{"__type":"FB","EC":"(3)","In":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":11,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"NewSwitch","Up":true},{"__type":"PRM","Arg":"PosStart","Ix":12,"Type":"REAL","Var":"NextPos"},{"__type":"PRM","Arg":"PosAbs","Ix":13,"Type":"BOOL","Var":"true"},{"__type":"PRM","Arg":"Length","Ix":14,"Type":"REAL","Var":"40"}],"Ix":17,"Name":"TS_AddSwitch","Out":[{"__type":"PRM","Arg":"MyTS","IO":true,"Ix":15,"Type":"THE\\TIMESTAMP","Var":"TS_Device_1"},{"__type":"PF","Arg":"ENO"}],"UD":true,"X":3,"Var":"NextPitch"}],"CMT":"The \"TS_Output_Single\" will apply a Switch to a physical output. Every TS card have the following IO map:\u000d\u000a- Output           Let you define the state you want (On\/Off) when the time stamp is reached\u000d\u000a- TimeStamp     Define in [ns] the time to swith the output\u000d\u000a- Status             Turn On when a valide time stamp order is received, and turn off when it's done.\u000d\u000a\u000d\u000aInfo:\u000d\u000a1. If you let TimeStamp to 0, the real output will follow Output\u000d\u000a2. You need 2 PLC cycle to give and order to the timestamp card (in rack, no idea in coupler). The minimum TS is : CurrentTS + 2x PLC_Cycle\u000d\u000a3. To apply the switch Off, you need to give a new TS order to reset the output! You will have the same two PLC cycle to reset. The min \"length\" of switch is 2 cycles.\u000d\u000a4. The status take one cycle to update. If i use the status to confirm an order, the minimum \"length\" will be 3 cycles: 2 to give the order, and one more to receive the feedback. I didn't use this feedback to optimise 1 cycle.\u000d\u000a\u000d\u000a\u000d\u000aCode: \u000d\u000aWhen the switch is done, \"TS_Output_Singel\" will put the last switch in \"SwitchDone\" output and give a \"Done\" signal (1)\u000d\u000aYou can use this \"SwitchDone\" to get the last switch position and use it to compute a new position (2)\u000d\u000aAnd when this new position is computed, i create a new switch 100 [u] later. The \"PosAbs\" is true to let me fixe an absolute position (3)\u000d\u000a\u000d\u000a\u000d\u000aChronogram:\u000d\u000a\u000d\u000aStat cycle __________|¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\u000d\u000a\u000d\u000aOutput     ______________________________|¯¯¯¯¯¯¯¯|____________________|¯¯¯¯¯¯¯¯|____________________|¯¯¯¯¯¯¯¯|____________________|¯¯¯¯¯¯¯¯|____________________|¯¯¯¯¯¯¯¯|____________________|¯¯¯¯¯¯¯¯|\u000d\u000a\u000d\u000a                                |---- 200 ----------| ------------- 200 -----------|------------- 200 -----------|------------- 200 -----------|------------- 200 -----------|------------- 200 -----------|\u000d\u000a                                                             |-- 40 --|","LRI":19,"RRI":20,"VLs":[]}
