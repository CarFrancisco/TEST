{"CLs":[{"__type":"LD","Var":"Enabled"},{"__type":"ST","Ix":4,"Var":"MySerial.Sta.Enabled","X":1},{"__type":"LD","Ix":1,"Not":true,"Var":"MySerial.Sta.Initalized","X":1,"Y":1},{"__type":"LD","Ix":2,"Var":"NX_Ready","X":2,"Y":1},{"__type":"ST","Ix":5,"S":true,"Var":"MySerial.Sta.Initalized","X":3,"Y":1},{"__type":"LD","Ix":3,"Var":"MySerial.Sta.Initalized","X":1,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":7,"Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":8,"Type":"ANY_ELEMENTARY, ENUM","Var":"0"}],"Ix":9,"Name":"=","Out":[{"__type":"PF","Arg":""}],"X":2,"Y":2,"PL":true},{"__type":"ST","Ix":6,"Var":"MySerial.Sta.Ready","X":3,"Y":2},{"__type":"HL","X":2},{"__type":"HL","X":3}],"CMT":"_______________________________________________________________________________________________________\u000a¦  Status                                                                                                                                               ¦\u000a¦______________________________________________________________________________________________________¦\u000d\u000a\u000d\u000aObject status","LRI":10,"RRI":11,"VLs":[{"Ix":12,"X":1},{"Ix":12,"X":1,"Y":1}]}
{"CLs":[{"__type":"LD","Var":"Enabled"},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":5,"Type":"ANY_BIT(except BOOL)","Var":"In_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":6,"Type":"USINT","Var":"9"}],"Ix":13,"Name":"TestABit","Out":[{"__type":"PF","Arg":""}],"X":1},{"__type":"ST","Ix":1,"Var":"Receive_Command","X":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":7,"Type":"ANY_BIT(except BOOL)","Var":"In_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":8,"Type":"USINT","Var":"12"}],"Ix":14,"Name":"TestABit","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":1},{"__type":"ST","Ix":2,"Var":"Receive_Data","X":2,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":9,"Type":"ANY_BIT(except BOOL)","Var":"In_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":10,"Type":"USINT","Var":"13"}],"Ix":15,"Name":"TestABit","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":2},{"__type":"ST","Ix":3,"Var":"Receive_LastData","X":2,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":11,"Type":"ANY_BIT(except BOOL)","Var":"In_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":12,"Type":"USINT","Var":"15"}],"Ix":16,"Name":"TestABit","Out":[{"__type":"PF","Arg":""}],"X":1,"Y":3},{"__type":"ST","Ix":4,"Var":"Receive_Error","X":2,"Y":3}],"CMT":"Read status flag","LRI":17,"RRI":18,"VLs":[{"Ix":19,"X":1},{"Ix":19,"X":1,"Y":1},{"Ix":19,"X":1,"Y":2}]}
{"CLs":[{"__type":"LD","Var":"MySerial.Sta.Initalized"},{"__type":"LD","Ix":1,"Not":true,"Var":"FirstRun","X":1},{"__type":"IST","EID":"99c784d4-75e5-4917-86de-49f52d3458cc","H":160,"Ix":2,"TXT":"\/\/ Convert header and terminator\u000d\u000aMySerial.Header := AryToString(Header[0], 4);\u000d\u000aMySerial.Terminator := AryToString(Terminator[0], 4);\u000d\u000a\u000d\u000a\/\/ Init read and write sequence\u000d\u000aS := 0;\u000d\u000aR := 0;\u000d\u000a\u000d\u000aFirstRun := TRUE;","W":521,"X":2}],"CMT":"_______________________________________________________________________________________________________\u000a¦  Initalization                                                                                                                                      ¦\u000a¦______________________________________________________________________________________________________¦\u000d\u000a","LRI":3,"RRI":4,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":4,"Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":5,"Type":"ANY_ELEMENTARY, ENUM","Var":"0"}],"Ix":10,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"LD","Ix":1,"Var":"MySerial.Sta.Ready","X":1},{"__type":"LD","Var":"MySerial.Cmd.Order","X":2},{"__type":"LD","Ix":2,"Var":"MySerial.Cmd.Write","X":3},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":6,"Type":"ANY","Var":"10"}],"Ix":11,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":7,"Type":"ANY","Var":"S"}],"X":4},{"__type":"LD","Ix":3,"Var":"MySerial.Cmd.Ask","X":3,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":8,"Type":"ANY","Var":"10"}],"Ix":12,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":9,"Type":"ANY","Var":"S"}],"X":4,"Y":1}],"CMT":"_______________________________________________________________________________________________________\u000a¦  Sending datas                                                                                                                                  ¦\u000a¦______________________________________________________________________________________________________¦\u000d\u000a\u000d\u000a0: Wait command from external bloc","LRI":13,"RRI":14,"VLs":[{"Ix":15,"X":3}]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"10"}],"Ix":2,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"IST","EID":"6cbc9bb2-e4e3-47ac-bb47-198dcbba33a6","H":242,"Ix":3,"TXT":"\/\/ Writing sequence in progress\u000d\u000aMySerial.Sta.Write := TRUE;\u000d\u000a\u000d\u000a\/\/ Complet string to send and get size\u000d\u000aStr_Send := CONCAT(MySerial.Header, MySerial.Cmd.Str, MySerial.Terminator);\u000d\u000aSize_Send := StringToAry(Str_Send, Ary_Send[0]);\u000d\u000aOffset_Send := 0;\u000d\u000a\u000d\u000a\/\/ Go to next step\u000d\u000aS := 20;","W":802,"X":1}],"CMT":"10: Preparing datas to send","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"20"}],"Ix":2,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"IST","EID":"da029925-fc74-47c2-b3ae-be23509f2bf5","H":605.99999999999977,"Ix":3,"TXT":"\/\/ Total output data size\u000d\u000aIF( (Size_Send - Offset_Send) > 20 ) THEN\u000d\u000a\u0009Out_Data_Length := 20;\u000d\u000a\u0009Send_Finish := FALSE;\/\/Not final data\u000d\u000aELSE\u000d\u000a\u0009Out_Data_Length := (Size_Send - Offset_Send);\u000d\u000a\u0009Send_Finish := TRUE;\/\/Final data\u000d\u000aEND_IF;\u000d\u000a\u000d\u000a\/\/Set output data and update new offset\u000d\u000aAryMove(Ary_Send[Offset_Send], Out_Data_01[0], UINT#4);\u000d\u000aAryMove(Ary_Send[Offset_Send+4], Out_Data_02[0], UINT#4);\u000d\u000aAryMove(Ary_Send[Offset_Send+8], Out_Data_03[0], UINT#4);\u000d\u000aAryMove(Ary_Send[Offset_Send+12], Out_Data_04[0], UINT#4);\u000d\u000aAryMove(Ary_Send[Offset_Send+16], Out_Data_05[0], UINT#4);\u000d\u000aOffset_Send:= Offset_Send + Out_Data_Length;\u000d\u000a\u000d\u000a\/\/ Set Output Data Type.\u000d\u000aIF( Send_Finish = TRUE ) THEN\u000d\u000a\u0009Send_Data := FALSE;\u000d\u000a\u0009Send_LastData :=TRUE;\u000d\u000aELSE\u000d\u000a\u0009Send_Data := TRUE;\u000d\u000a\u0009Send_LastData :=FALSE;\u000d\u000aEND_IF;\u000d\u000a\u000d\u000a\/\/ Set Output SID.\u000d\u000aOut_SID := Out_SID + 1;\u000d\u000a\u000d\u000a\/\/ Go to next step\u000d\u000aS := 30;","W":763,"X":1}],"CMT":"20: Write the 20 first element to send","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":4,"Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":5,"Type":"ANY_ELEMENTARY, ENUM","Var":"30"}],"Ix":14,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":8,"Type":"ANY_ELEMENTARY, ENUM","Var":"Out_SID"},{"__type":"PRM","Arg":"In2","Ix":9,"Type":"ANY_ELEMENTARY, ENUM","Var":"Out_SID_Response"}],"Ix":16,"Name":"=","Out":[{"__type":"PF","Arg":""}],"X":1,"PL":true},{"__type":"LD","Not":true,"Var":"Send_Finish","X":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":6,"Type":"ANY","Var":"20"}],"Ix":15,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":7,"Type":"ANY","Var":"S"}],"X":3},{"__type":"LD","Ix":1,"Var":"Send_Finish","X":2,"Y":1},{"__type":"LD","Ix":2,"Var":"MySerial.Cmd.Write","X":3,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":10,"Type":"ANY","Var":"100"}],"Ix":17,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":11,"Type":"ANY","Var":"S"}],"X":4,"Y":1},{"__type":"LD","Ix":3,"Var":"MySerial.Cmd.Ask","X":3,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":12,"Type":"ANY","Var":"50"}],"Ix":18,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":13,"Type":"ANY","Var":"S"}],"X":4,"Y":2},{"__type":"HL","X":4}],"CMT":"30: Wait until command is send","LRI":19,"RRI":20,"VLs":[{"Ix":21,"X":2},{"Ix":22,"X":3,"Y":1}]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"50"}],"Ix":2,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"IST","EID":"283022b8-f201-473f-ab12-6058ed896b62","H":165.00000000000023,"Ix":3,"TXT":"\/\/ Complet string to send and get size\u000d\u000aStr_Receive := '';\u000d\u000aSize_Receive := 0;\u000d\u000a\u000d\u000a\/\/ Go to next step\u000d\u000aS := 60;","W":769,"X":1}],"CMT":"50: Preparing to receive datas","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"60"}],"Ix":6,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":2,"Type":"ANY_ELEMENTARY, ENUM","Var":"In_SID"},{"__type":"PRM","Arg":"In2","Ix":3,"Type":"ANY_ELEMENTARY, ENUM","Var":"In_SID_Response"}],"Ix":7,"Name":"<>","Out":[{"__type":"PF","Arg":""}],"X":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":4,"Type":"ANY","Var":"70"}],"Ix":8,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":5,"Type":"ANY","Var":"S"}],"X":2}],"CMT":"60: Wait to receive data. New data will increase the SID value","LRI":9,"RRI":10,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"70"}],"Ix":2,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"IST","EID":"db8ced92-f94e-47c3-9017-58586b2ae9cd","H":476.00000000000023,"Ix":3,"TXT":"\/\/ Confirm data reception\u000d\u000aIn_SID_Response := In_SID;\u000d\u000a\u000d\u000a\/\/ Move received datas in array\u000d\u000aAryMove(In_Data_01[0], Ary_Receive[0], 4);\u000d\u000aAryMove(In_Data_02[0], Ary_Receive[4], 4);\u000d\u000aAryMove(In_Data_03[0], Ary_Receive[8], 4);\u000d\u000aAryMove(In_Data_04[0], Ary_Receive[12], 4);\u000d\u000aAryMove(In_Data_05[0], Ary_Receive[16], 4);\u000d\u000a\u000d\u000a\/\/ Convert the array in string, and add it to output\u000d\u000aStr_Receive := CONCAT(Str_Receive, AryToString( Ary_Receive[0], In_Data_Length ) );\u000d\u000a\u000d\u000a\/\/ Update size\u000d\u000aSize_Receive := Size_Receive + In_Data_Length;\u000d\u000a\u000d\u000a\/\/ Check if reception is finish           ******************* The flag Receive Data and Last data dosn't work!\u000d\u000a\/\/ \u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009\u0009I will use therminator detection\u000d\u000aIF FIND(Str_Receive, MySerial.Terminator) = 0 THEN\u000d\u000a\u0009S := 60;\u0009\u0009\/\/ Wait for next part\u000d\u000aELSE\u000d\u000a\u0009S := 80;\u0009\u0009\/\/ Go to final part\u000d\u000aEND_IF;","W":879,"X":1}],"CMT":"70: Get received datas","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":1,"Type":"ANY_ELEMENTARY, ENUM","Var":"80"}],"Ix":2,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"IST","EID":"88556f69-acd3-42a3-b277-deb688707a0e","H":277.0000000000004,"Ix":3,"TXT":"\/\/ Get pos and size of header and terminator\u000d\u000aPos_Header := FIND(Str_Receive, MySerial.Header);\u000d\u000aPos_Terminator := FIND(Str_Receive, MySerial.Terminator);\u000d\u000a\u000d\u000a\/\/ Text computation\u000d\u000aPos := Pos_Header + LEN(MySerial.Header);\u000d\u000aNb :=Pos_Terminator - Pos;\u000d\u000a\u000d\u000aMySerial.Respond.Str := MID(Str_Receive, Nb, Pos);\u000d\u000a\u000d\u000a\/\/ Finish received\u000d\u000aS := 100;","W":749,"X":1}],"CMT":"80: Clean and move received datas","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":2,"Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":3,"Type":"ANY_ELEMENTARY, ENUM","Var":"100"}],"Ix":6,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"ST","Ix":1,"Var":"MySerial.Sta.Done","X":1},{"__type":"LD","Var":"MySerial.Cmd.Done","X":1,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":4,"Type":"ANY","Var":"110"}],"Ix":7,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":5,"Type":"ANY","Var":"S"}],"X":2,"Y":1},{"__type":"HL","X":2}],"CMT":"100: Wait until external bloc as finish. Confirmation with reset of status done","LRI":8,"RRI":9,"VLs":[{"Ix":10,"X":1}]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":3,"Type":"ANY_ELEMENTARY, ENUM","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":4,"Type":"ANY_ELEMENTARY, ENUM","Var":"110"}],"Ix":7,"Name":"=","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"ST","RS":true,"Var":"MySerial.Cmd.Done","X":1},{"__type":"ST","Ix":1,"RS":true,"Var":"MySerial.Sta.Done","X":1,"Y":1},{"__type":"ST","Ix":2,"RS":true,"Var":"MySerial.Sta.Fault","X":1,"Y":2},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":5,"Type":"ANY","Var":"0"}],"Ix":8,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":6,"Type":"ANY","Var":"S"}],"X":1,"Y":3}],"CMT":"110: Reset order of external bloc and all status and go next step","LRI":9,"RRI":10,"VLs":[{"Ix":11,"X":1},{"Ix":11,"X":1,"Y":1},{"Ix":11,"X":1,"Y":2}]}
{"CLs":[{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In1","Ix":1,"Type":"ANY_ELEMENTARY(except BOOL)","Var":"S"},{"__type":"PRM","Arg":"In2","Ix":2,"Type":"ANY_ELEMENTARY(except BOOL)","Var":"0"}],"Ix":3,"Name":">","Out":[{"__type":"PF","Arg":""}],"PL":true},{"__type":"ST","Var":"Busy","X":1}],"CMT":"Status","LRI":4,"RRI":5,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"Enabled"},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":1,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":2,"Type":"USINT","Var":"8"},{"__type":"PRM","Arg":"BitVal","Ix":3,"Type":"BOOL","Var":"Send_Command"}],"Ix":16,"Name":"OutABit","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":4,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"","Ix":5,"Type":"BOOL","Var":""}],"X":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":6,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":7,"Type":"USINT","Var":"12"},{"__type":"PRM","Arg":"BitVal","Ix":8,"Type":"BOOL","Var":"Send_Data"}],"Ix":17,"Name":"OutABit","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":9,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"","Ix":10,"Type":"BOOL","Var":""}],"X":1,"Y":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":11,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"Pos","Ix":12,"Type":"USINT","Var":"13"},{"__type":"PRM","Arg":"BitVal","Ix":13,"Type":"BOOL","Var":"Send_LastData"}],"Ix":18,"Name":"OutABit","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"InOut","IO":true,"Ix":14,"Type":"ANY_BIT(except BOOL)","Var":"Out_Data_Type"},{"__type":"PRM","Arg":"","Ix":15,"Type":"BOOL","Var":""}],"X":1,"Y":2}],"CMT":"Write command flag","LRI":19,"RRI":20,"VLs":[{"Ix":21,"X":1},{"Ix":21,"X":1,"Y":1}]}
